<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>ğŸ®</text></svg>">

  <title>Manifest</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    .disabled { opacity: .6; pointer-events: none; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

  <!-- Menu -->
  <div class="fixed top-4 right-4 z-50">
    <div class="relative">
      <button id="menuBtn" class="bg-gray-700 px-3 py-2 rounded-lg hover:bg-gray-600">â˜°</button>
      <div id="menuDropdown" class="hidden absolute right-0 mt-2 w-56 bg-gray-700 rounded-lg shadow-lg overflow-hidden">
        <a href="https://github.com/DROISD123/steam" target="_blank" class="block px-4 py-2 hover:bg-gray-600">ğŸ“‚ GitHub Repo</a>
        <a href="#" onclick="openMantaTool()" class="block px-4 py-2 hover:bg-gray-600">ğŸ› ï¸ Manta Tool</a>
        <a href="#" onclick="openSteamTool()" class="block px-4 py-2 hover:bg-gray-600">ğŸ® Steam Tools</a>
        <a href="#" onclick="openAbout()" class="block px-4 py-2 hover:bg-gray-600">â„¹ï¸ About</a>
        <a href="#" onclick="openHelp()" class="block px-4 py-2 hover:bg-gray-600">â“ Help</a>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto p-6">
    <div class="bg-gray-800 rounded-xl p-6 shadow-lg">
      <div class="mb-4">
        <h1 class="text-center text-2xl sm:text-3xl font-bold text-indigo-300 flex items-center justify-center gap-3">
          <span>ğŸ®</span><span>Manifest steam</span>
        </h1>
      </div>

      <!-- Search -->
      <div class="mb-4">
        <div class="flex">
          <input id="searchInput" type="text" placeholder="Cari berdasarkan nama atau ID game..."
            class="flex-1 p-3 rounded-l-lg bg-gray-700 text-white focus:outline-none" />
          <button id="searchBtn" class="bg-blue-500 hover:bg-blue-600 px-4 py-3 rounded-r-lg">Cari</button>
        </div>
      </div>

      <div id="status" class="mb-4 text-sm"></div>

      <!-- Grid: responsif -->
      <div id="results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6"></div>

      <!-- (Opsional) tombol load more: kita sembunyikan karena render semua -->
      <div class="flex justify-center mt-6">
        <button id="loadMoreBtn" class="hidden bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg">Load More</button>
      </div>
    </div>
  </div>
  <!-- Modals (About, Help, Manta, Steam Tool) -->
    <!-- Modals -->
 <div id="aboutModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
    <div class="bg-gray-800 text-gray-200 rounded-xl shadow-lg p-6 max-w-lg w-full">
      <h2 class="text-xl font-bold mb-3">â„¹ï¸ Tentang ManifestHub</h2>
      <p class="mb-3"><b>ManifestHub Downloader + Steam Info</b> adalah alat untuk mencari game berdasarkan <i>nama</i> atau <i>App ID</i> dari Steam. Website ini menampilkan detail game dari Steam Store API dan memberi opsi untuk mengunduh branch ZIP dari repo GitHub ManifestHub jika tersedia.</p>
      <ul class="list-disc list-inside mb-4 space-y-1">
        <li>ğŸ” Cari game berdasarkan nama / ID</li>
        <li>ğŸ“¥ Download ZIP branch GitHub (jika tersedia)</li>
        <li>ğŸ“± Tampilan responsif untuk desktop & mobile</li>
      </ul>
      <p class="text-sm text-gray-400 mb-4">Dibuat untuk keperluan edukasi & eksperimen. Sumber data: Steam Store API & GitHub ManifestHub Repo.</p>
      <div class="flex gap-2">
        <button onclick="closeAbout()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Tutup</button>
        <button onclick="window.open('https://github.com/SteamAutoCracks/ManifestHub','_blank')" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">ğŸŒ GitHub Repo</button>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
    <div class="bg-gray-800 text-gray-200 rounded-xl shadow-lg p-6 max-w-lg w-full">
      <h2 class="text-xl font-bold mb-3">â“ Bantuan Penggunaan</h2>
      <p class="mb-3">Panduan singkat:</p>
      <ul class="list-disc list-inside space-y-2 mb-4">
        <li>ğŸ” <b>Pencarian:</b> Ketik <i>nama game</i> atau <i>App ID</i> lalu tekan <b>Cari</b>.</li>
        <li>ğŸ“– <b>Deskripsi Game:</b> Klik <b>Baca Selengkapnya</b> untuk melihat teks penuh.</li>
        <li>ğŸ“‚ <b>Download ZIP:</b> Tombol hijau aktif hanya jika branch GitHub tersedia dan game sudah rilis.</li>
      </ul>
      <p class="text-sm text-gray-400 mb-4">Tip: jika pencarian nama menghasilkan banyak, gunakan App ID untuk hasil spesifik.</p>
      <div><button onclick="closeHelp()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Tutup</button></div>
    </div>
  </div>

  <!-- Manta Tool Modal (placeholder) -->
  <div id="mantaModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
    <div class="bg-gray-800 text-gray-200 rounded-xl shadow-lg p-6 max-w-lg w-full">
      <h2 class="text-xl font-bold mb-3">ğŸ› ï¸ Manta Tool</h2>
      <p class="mb-3">Manta Tool â€” (placeholder). Masukkan deskripsi / link download atau instruksi penggunaan di sini.</p>
      <p class="text-sm text-gray-400 mb-4">Jika ada file atau link, ganti tombol di bawah dengan URL yang sesuai.</p>
      <div class="flex gap-2">
        <button onclick="closeMantaTool()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Tutup</button>
      </div>
    </div>
  </div>

 
  <!-- Modal Steam Tool -->
<div id="steamToolModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
  <div class="bg-gray-800 text-gray-200 rounded-xl shadow-lg p-6 max-w-2xl w-full">
    <div class="flex justify-between items-start mb-4">
      <h2 class="text-xl font-bold">ğŸ® SteamTools</h2>
      <button onclick="closeSteamTool()" class="text-sm bg-gray-700 px-2 py-1 rounded hover:bg-gray-600">Tutup</button>
    </div>

    <p class="mb-3"><b>SteamTools</b> adalah alat terbaik untuk para pengguna Steam!  
    Dengan aplikasi ini, Anda bisa langsung mengakses data profil Steam tanpa harus menggunakan situs konversi yang lambat.  
    Anda juga bisa melihat akun lokal yang pernah login, memindai direktori Steam untuk menemukan file dengan tanda SteamID, dan banyak lagi.</p>

    <p class="mb-3">Jika Anda ingin memberi saran, melaporkan bug, atau masukan lainnya, silakan buat issue di GitHub repository asli.</p>

    <h3 class="font-semibold mt-4 mb-2">âœ¨ Fitur</h3>
    <ul class="list-disc list-inside mb-4 space-y-1 text-sm text-gray-300">
      <li>Mendapatkan informasi tentang profil Steam lebih cepat dibanding situs konversi.</li>
      <li>Melihat akun lokal yang pernah login di komputer Anda.</li>
      <li>Memindai folder Steam untuk menemukan file yang mengandung SteamID Anda.</li>
    </ul>

    <h3 class="font-semibold mt-4 mb-2">ğŸ“¥ Instalasi</h3>
    <ol class="list-decimal list-inside mb-4 space-y-2 text-sm">
      <li>Buka Visual Studio atau JetBrains Rider.</li>
      <li>Pilih <b>Clone Repo</b> lalu masukkan URL:  
        <code>https://github.com/naumenkoff/SteamTools.git</code></li>
      <li>Setelah repo ter-clone, buka project <code>SteamTools.UI</code>.</li>
      <li>Di file <code>appsettings.json</code>, masukkan Steam Web API Key Anda.</li>
      <li>Kompilasi dan jalankan aplikasi.</li>
    </ol>

    <h3 class="font-semibold mt-4 mb-2">ğŸ›£ï¸ Roadmap</h3>
    <ul class="list-disc list-inside space-y-1 text-sm">
      <li>Pindah ke platform WPF dengan UI modern.</li>
      <li>Tampilan antarmuka untuk ProfileDataFetcher (riwayat permintaan, hasil pencarian).</li>
      <li>Tampilan antarmuka untuk LocalProfileScanner (daftar akun yang ditemukan).</li>
      <li>Tampilan antarmuka untuk IDScanner (opsi pemindaian paralel, ekstensi file, hasil scan).</li>
      <li>Styling sesuai Windows 11 (Mica & sudut membulat).</li>
      <li>Implementasi kontrol custom (CheckBox, TextBox, ListView, dsb).</li>
      <li>Notifikasi modern (toast notification).</li>
    </ul>

    <div class="mt-4 flex gap-2">
      <a href="https://github.com/naumenkoff/SteamTools" target="_blank" 
         class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">ğŸŒ Repo SteamTools</a>
      <a href=https://www.steamtools.net/res/st-setup-1.8.17r2.exe 
         class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">â¬‡ï¸ Download release</a>
    </div>
  </div>
</div>

  <!-- Tombol scroll atas/bawah -->
  <button id="scrollTopBtn" class="hidden fixed bottom-20 right-5 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-full shadow-lg transition-opacity duration-300 z-50">â¬†ï¸</button>
  <button id="scrollBottomBtn" class="hidden fixed bottom-5 right-5 bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-full shadow-lg transition-opacity duration-300 z-50">â¬‡ï¸</button>

<script>
  // ===== JSON redirect (opsional) =====
  (function checkJsonMode(){
    const params = new URLSearchParams(window.location.search);
    if (params.get('json') === '1' && params.get('id')) {
      const id = params.get('id');
      const serverJsonUrl = `/json?id=${encodeURIComponent(id)}`;
      window.location.replace(serverJsonUrl);
    }
  })();

  // ===== Menu =====
  const menuBtn = document.getElementById('menuBtn');
  const menuDropdown = document.getElementById('menuDropdown');
  menuBtn?.addEventListener('click', (e) => { e.stopPropagation(); menuDropdown.classList.toggle('hidden'); });
  window.addEventListener('click', (e) => { if (!e.target.closest('#menuDropdown') && !e.target.closest('#menuBtn')) menuDropdown.classList.add('hidden'); });

  function openAbout(){ aboutModal.classList.remove('hidden'); aboutModal.classList.add('flex'); }
  function closeAbout(){ aboutModal.classList.add('hidden'); aboutModal.classList.remove('flex'); }
  function openHelp(){ helpModal.classList.remove('hidden'); helpModal.classList.add('flex'); }
  function closeHelp(){ helpModal.classList.add('hidden'); helpModal.classList.remove('flex'); }
  function openMantaTool(){ mantaModal.classList.remove('hidden'); mantaModal.classList.add('flex'); }
  function closeMantaTool(){ mantaModal.classList.add('hidden'); mantaModal.classList.remove('flex'); }
  function openSteamTool(){ steamToolModal.classList.remove('hidden'); steamToolModal.classList.add('flex'); }
  function closeSteamTool(){ steamToolModal.classList.add('hidden'); steamToolModal.classList.remove('flex'); }

  // ===== State =====
  const owner = "SteamAutoCracks";
  const repo  = "ManifestHub";
  let allResults = [];
  let shownCount = 0;

  const searchBtn = document.getElementById('searchBtn');
  const searchInput = document.getElementById('searchInput');
  const loadMoreBtn = document.getElementById('loadMoreBtn');

  searchBtn.addEventListener('click', doSearch);
  searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') doSearch(); });

  function setStatus(msg, isError=false){
    const el = document.getElementById('status');
    el.textContent = msg || '';
    el.className = isError ? 'mb-4 text-red-400 text-sm' : (msg ? 'mb-4 text-yellow-300 text-sm' : 'mb-4 text-sm');
  }

  // ===== Utils =====
  function formatIDR(s) {
    try { return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(s); }
    catch { return `Rp ${Number(s||0).toLocaleString('id-ID')}`; }
  }
async function checkBranchExists(appId) {
  try {
    const r = await fetch(`/api/zip-exists?id=${encodeURIComponent(appId)}`);
    const j = await r.json();
    return !!j.exists;
  } catch {
    return false;
  }
}

function makeButtons(appId){
  const wrap = document.createElement('div');
  // mt-auto = dorong ke bawah; h-11 = tinggi tombol konsisten
  wrap.className = 'mt-4 mt-auto grid grid-cols-1 gap-2';

  const btnZip = document.createElement('a');
  btnZip.href = '#';
  btnZip.className = 'h-11 w-full text-center px-4 py-2 rounded-lg bg-gray-500 cursor-not-allowed flex items-center justify-center';
  btnZip.textContent = 'â¬‡ï¸ Download ZIP';
  checkBranchExists(appId).then(exists => {
    if (exists){
      btnZip.href = `https://codeload.github.com/${owner}/${repo}/zip/refs/heads/${appId}`;
      btnZip.className = 'h-11 w-full text-center px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700 flex items-center justify-center';
    } else {
      btnZip.textContent = 'âš ï¸ ZIP tidak tersedia';
    }
  });

  const btnSteam = document.createElement('a');
  btnSteam.href = `https://store.steampowered.com/app/${appId}`;
  btnSteam.target = '_blank';
  btnSteam.className = 'h-11 w-full text-center px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 flex items-center justify-center';
  btnSteam.textContent = 'ğŸŒ Buka di Steam';

  wrap.appendChild(btnZip);
  wrap.appendChild(btnSteam);
  return wrap;
}

  // ===== Search =====
  async function doSearch(){
    const q = searchInput.value.trim();
    if (!q) return;
    document.getElementById('results').innerHTML = '';
    setStatus('â³ Mencari game...');

    try {
      let appIds = [];
      if (/^\d+$/.test(q)) appIds = [q];
      else {
        const r = await fetch(`/api/search?q=${encodeURIComponent(q)}&cc=id&l=indonesian`);
        const data = await r.json();
        if (data.items?.length) appIds = data.items.map(i => i.id);
      }

      if (!appIds.length) { setStatus('âŒ Game tidak ditemukan.', true); return; }

      allResults = [];
      for (const id of appIds) {
        try {
          const r = await fetch(`/api/appdetails?id=${id}&cc=id&l=indonesian`);
          const obj = await r.json();
          if (obj[id]?.success) allResults.push(obj[id].data);
        } catch(e){ console.error(e); }
      }
      if (!allResults.length) { setStatus('âš ï¸ Gagal mengambil data.', true); return; }

      renderResults();     // tampilkan semua
      setStatus('');
    } catch (err){
      console.error(err);
      setStatus('âš ï¸ Terjadi error: ' + (err.message || err), true);
    }
  }

  function renderResults(){
    const container = document.getElementById('results');
    container.innerHTML = '';
    allResults.forEach(game => container.appendChild(makeCard(game)));
    loadMoreBtn.classList.add('hidden'); // tak pakai pagination
  }

  function makeCard(game){
    const wrapper = document.createElement('div');
    wrapper.className = 'bg-gray-700 p-4 rounded-lg shadow flex flex-col hover:shadow-xl transition-transform duration-200';

    const img = document.createElement('img');
    img.src = game.header_image || '';
    img.alt = game.name || '';
    img.loading = 'lazy';
    img.className = 'w-full rounded-lg object-cover mb-3';
    wrapper.appendChild(img);

    const title = document.createElement('h3');
    title.className = 'text-lg font-semibold mb-2 text-blue-300';
    title.textContent = `${game.name || 'Unknown'} (ID: ${game.steam_appid || '-'})`;
    wrapper.appendChild(title);

    const desc = document.createElement('p');
    desc.className = 'text-sm text-gray-300 line-clamp-3 overflow-hidden mb-2';
    desc.textContent = game.short_description || '';
    wrapper.appendChild(desc);

    const meta = document.createElement('div');
    meta.className = 'text-sm space-y-1';
    meta.innerHTML = `
      <div>ğŸ“… Rilis: <span class="text-gray-200">${(game.release_date && game.release_date.date) ? game.release_date.date : '-'}</span></div>
      <div>ğŸ­ Genre: <span class="text-gray-200">${(game.genres || []).map(g=>g.description).join(', ') || '-'}</span></div>
      <div>ğŸ’» Platform: <span class="text-gray-200">${Object.keys(game.platforms || {}).filter(p=>game.platforms[p]).join(', ') || '-'}</span></div>
      <div>ğŸ’² Harga: <span class="text-gray-200">${game.is_free ? 'Gratis' : (game.price_overview?.final_formatted || 'Tidak diketahui')}</span></div>
    `;
    wrapper.appendChild(meta);

    wrapper.appendChild(makeButtons(game.steam_appid)); // tombol vertikal
    return wrapper;
  }

  // ===== Featured / Event (ID) =====
  async function loadSteamEvents() {
    setStatus('ğŸ”¥ Menampilkan game event/diskon Steam (Indonesia)...');
    const container = document.getElementById('results');
    container.innerHTML = '';

    try {
      const r = await fetch('/api/featured?cc=id&l=indonesian');
      const data = await r.json();
      const items = (data?.specials?.items?.length ? data.specials.items
                    : data?.topsellers?.items?.length ? data.topsellers.items : []);
      if (!items.length) { setStatus('âš ï¸ Tidak ada event Steam ditemukan saat ini.', true); return; }

      // tampilkan semua
      const details = await Promise.all(items.map(async (g) => {
        try {
          const rr = await fetch(`/api/appdetails?id=${g.id}&cc=id&l=indonesian`);
          const raw = await rr.json();
          const node = raw?.[g.id];
          return node?.success ? node.data : null;
        } catch { return null; }
      }));

      items.forEach((g, idx) => {
        const d = details[idx];
        const card = document.createElement('div');
        card.className = 'bg-gray-700 p-4 rounded-lg shadow flex flex-col hover:shadow-xl transition-transform duration-200';

        const img = document.createElement('img');
        img.src = g.large_capsule_image || g.header_image || '';
        img.alt = g.name || '';
        img.className = 'w-full rounded-lg mb-3 object-cover';
        card.appendChild(img);

        const title = document.createElement('h3');
        title.className = 'text-lg font-semibold mb-2 text-blue-300';
        title.textContent = `${g.name} (ID: ${g.id})`;
        card.appendChild(title);

        const priceP = document.createElement('p');
        priceP.className = 'text-sm mb-2';
        const pov = d?.price_overview;
        if (pov?.final_formatted) {
          if (pov.discount_percent > 0) {
            priceP.innerHTML = `ğŸª™ <span class="line-through text-gray-400">${pov.initial_formatted || formatIDR(pov.initial)}</span> â†’ <b>${pov.final_formatted || formatIDR(pov.final)}</b> (-${pov.discount_percent}%)`;
          } else {
            priceP.textContent = d?.is_free ? 'Gratis' : `ğŸª™ ${pov.final_formatted}`;
          }
        } else if (g.discounted) priceP.textContent = `ğŸª™ Diskon ${g.discount_percent}%`;
        else priceP.textContent = 'ğŸª™ Lihat harga di Steam';
        card.appendChild(priceP);

        card.appendChild(makeButtons(g.id));
        container.appendChild(card);
      });

      setStatus('');
    } catch (err) {
      console.error(err);
      setStatus('âš ï¸ Gagal memuat event Steam.', true);
    }
  }

  // ===== Scroll top/bottom buttons =====
  const scrollTopBtn = document.getElementById('scrollTopBtn');
  const scrollBottomBtn = document.getElementById('scrollBottomBtn');
  function smoothScroll(y) { window.scrollTo({ top: y, behavior: 'smooth' }); }
  scrollTopBtn.addEventListener('click', () => smoothScroll(0));
  scrollBottomBtn.addEventListener('click', () => smoothScroll(document.body.scrollHeight));
  window.addEventListener('scroll', () => {
    const scrolled = window.scrollY;
    const nearBottom = (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 200;
    scrolled > 200 ? scrollTopBtn.classList.remove('hidden') : scrollTopBtn.classList.add('hidden');
    !nearBottom ? scrollBottomBtn.classList.remove('hidden') : scrollBottomBtn.classList.add('hidden');
  });

  // ===== Init: tampilkan featured jika belum cari =====
  document.addEventListener('DOMContentLoaded', () => {
    if (!searchInput.value.trim()) loadSteamEvents();
  });
</script>
</body>
</html>
