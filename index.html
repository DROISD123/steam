<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ManifestHub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    .disabled { opacity: .6; pointer-events: none; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

  <!-- Menu fixed pojok kanan atas -->
  <div class="fixed top-4 right-4 z-50">
    <div class="relative">
      <button id="menuBtn" class="bg-gray-700 px-3 py-2 rounded-lg hover:bg-gray-600">☰</button>
      <div id="menuDropdown" class="hidden absolute right-0 mt-2 w-56 bg-gray-700 rounded-lg shadow-lg overflow-hidden">
        <a href="https://github.com/DROISD123/steam" target="_blank" class="block px-4 py-2 hover:bg-gray-600">📂 GitHub Repo</a>
        <a href="#" onclick="openMantaTool()" class="block px-4 py-2 hover:bg-gray-600">🛠️ Manta Tool</a>
        <a href="#" onclick="openSteamTool()" class="block px-4 py-2 hover:bg-gray-600">🎮 Steam Tools</a>
        <a href="#" onclick="openAbout()" class="block px-4 py-2 hover:bg-gray-600">ℹ️ About</a>
        <a href="#" onclick="openHelp()" class="block px-4 py-2 hover:bg-gray-600">❓ Help</a>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto p-6">
    <div class="bg-gray-800 rounded-xl p-6 shadow-lg">
      <!-- Header -->
      <div class="mb-4">
        <h1 class="text-center text-2xl sm:text-3xl font-bold text-indigo-300 flex items-center justify-center gap-3">
          <span>🎮</span>
          <span>ManifestHub</span>
        </h1>
      </div>

      <!-- Search -->
      <div class="mb-4">
        <div class="flex">
          <input id="searchInput" type="text" placeholder="Cari berdasarkan nama atau ID game..."
            class="flex-1 p-3 rounded-l-lg bg-gray-700 text-white focus:outline-none" />
          <button id="searchBtn" class="bg-blue-500 hover:bg-blue-600 px-4 py-3 rounded-r-lg">Cari</button>
        </div>
      </div>

      <div id="status" class="mb-4 text-sm"></div>

      <!-- Results grid -->
      <div id="results" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

      <div class="flex justify-center mt-6">
        <button id="loadMoreBtn" class="hidden bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg">Load More</button>
      </div>
    </div>
  </div>

  <!-- === MODALS (About, Help, Manta, Steam Tools) === -->
  <div id="aboutModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
    <div class="bg-gray-800 text-gray-200 rounded-xl shadow-lg p-6 max-w-lg w-full">
      <h2 class="text-xl font-bold mb-3">ℹ️ Tentang ManifestHub</h2>
      <p class="mb-3"><b>ManifestHub Downloader + Steam Info</b> adalah alat untuk mencari game berdasarkan <i>nama</i> atau <i>App ID</i> dari Steam. Website ini menampilkan detail game dari Steam Store API dan memberi opsi untuk mengunduh branch ZIP dari repo GitHub ManifestHub jika tersedia.</p>
      <ul class="list-disc list-inside mb-4 space-y-1">
        <li>🔍 Cari game berdasarkan nama / ID</li>
        <li>📥 Download ZIP branch GitHub (jika tersedia)</li>
        <li>📱 Tampilan responsif untuk desktop & mobile</li>
      </ul>
      <div class="flex gap-2">
        <button onclick="closeAbout()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Tutup</button>
      </div>
    </div>
  </div>

  <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
    <div class="bg-gray-800 text-gray-200 rounded-xl shadow-lg p-6 max-w-lg w-full">
      <h2 class="text-xl font-bold mb-3">❓ Bantuan Penggunaan</h2>
      <ul class="list-disc list-inside space-y-2 mb-4">
        <li>🔍 <b>Pencarian:</b> Ketik <i>nama game</i> atau <i>App ID</i> lalu tekan <b>Cari</b>.</li>
        <li>📂 <b>Download ZIP:</b> Tombol aktif hanya jika branch GitHub tersedia & game sudah rilis.</li>
      </ul>
      <div><button onclick="closeHelp()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Tutup</button></div>
    </div>
  </div>

  <div id="mantaModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
    <div class="bg-gray-800 text-gray-200 rounded-xl shadow-lg p-6 max-w-lg w-full">
      <h2 class="text-xl font-bold mb-3">🛠️ Manta Tool</h2>
      <p class="mb-3">Manta Tool — (placeholder).</p>
      <div class="flex gap-2">
        <button onclick="closeMantaTool()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Tutup</button>
      </div>
    </div>
  </div>

  <div id="steamToolModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
    <div class="bg-gray-800 text-gray-200 rounded-xl shadow-lg p-6 max-w-2xl w-full">
      <h2 class="text-xl font-bold mb-3">🎮 SteamTools</h2>
      <p class="mb-3">SteamTools adalah tool untuk mengakses data profil Steam dengan cepat, melihat akun lokal, serta memindai direktori Steam.</p>
      <div class="flex gap-2 mt-4">
        <a href="https://github.com/naumenkoff/SteamTools" target="_blank" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">🌐 Repo SteamTools</a>
        <a href="https://www.steamtools.net/res/st-setup-1.8.17r2.exe" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">⬇️ Download</a>
      </div>
    </div>
  </div>

<script>
/* ========= JSON ENDPOINT SUPPORT ========= */
(async function() {
  const params = new URLSearchParams(window.location.search);
  if (params.has("json")) {
    const q = params.get("id") || params.get("search");
    if (!q) {
      document.body.innerText = JSON.stringify({ error: "missing query" });
      return;
    }
    try {
      let appIds = [];
      if (/^\d+$/.test(q)) {
        appIds = [q];
      } else {
        const searchUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent("https://store.steampowered.com/api/storesearch/?term=" + q + "&cc=us")}`;
        const r = await fetch(searchUrl);
        const data = await r.json();
        if (data.items?.length) appIds = data.items.map(i => i.id);
      }
      let results = [];
      for (const id of appIds) {
        try {
          const detailUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent("https://store.steampowered.com/api/appdetails?appids=" + id + "&cc=us")}`;
          const r = await fetch(detailUrl);
          const obj = await r.json();
          if (obj[id]?.success) results.push(obj[id].data);
        } catch {}
      }
      document.body.innerText = JSON.stringify({ results }, null, 2);
    } catch (e) {
      document.body.innerText = JSON.stringify({ error: e.message });
    }
  }
})();

/* ========= UI CODE (tidak berubah) ========= */
const menuBtn = document.getElementById('menuBtn');
const menuDropdown = document.getElementById('menuDropdown');
menuBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  menuDropdown.classList.toggle('hidden');
});
window.addEventListener('click', (e) => {
  if (!e.target.closest('#menuDropdown') && !e.target.closest('#menuBtn')) {
    menuDropdown.classList.add('hidden');
  }
});

// modal helpers
function openAbout(){ aboutModal.classList.remove('hidden'); aboutModal.classList.add('flex'); }
function closeAbout(){ aboutModal.classList.add('hidden'); aboutModal.classList.remove('flex'); }
function openHelp(){ helpModal.classList.remove('hidden'); helpModal.classList.add('flex'); }
function closeHelp(){ helpModal.classList.add('hidden'); helpModal.classList.remove('flex'); }
function openMantaTool(){ mantaModal.classList.remove('hidden'); mantaModal.classList.add('flex'); }
function closeMantaTool(){ mantaModal.classList.add('hidden'); mantaModal.classList.remove('flex'); }
function openSteamTool(){ steamToolModal.classList.remove('hidden'); steamToolModal.classList.add('flex'); }
function closeSteamTool(){ steamToolModal.classList.add('hidden'); steamToolModal.classList.remove('flex'); }

// Search
const owner = "SteamAutoCracks";
const repo = "ManifestHub";
let allResults = [], shownCount = 0;
const perPage = 6;

const searchBtn = document.getElementById('searchBtn');
const searchInput = document.getElementById('searchInput');
const loadMoreBtn = document.getElementById('loadMoreBtn');

searchBtn.addEventListener('click', doSearch);
searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') doSearch(); });
loadMoreBtn.addEventListener('click', loadMore);

function setStatus(msg, isError=false){
  const el = document.getElementById('status');
  el.textContent = msg || '';
  el.className = isError ? 'mb-4 text-red-400 text-sm' : (msg ? 'mb-4 text-yellow-300 text-sm' : 'mb-4 text-sm');
}

async function doSearch(){
  const q = searchInput.value.trim();
  if (!q) return;
  document.getElementById('results').innerHTML = '';
  loadMoreBtn.classList.add('hidden');
  setStatus('⏳ Mencari game...');

  try {
    let appIds = [];
    if (/^\d+$/.test(q)) {
      appIds = [q];
    } else {
      const searchUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent("https://store.steampowered.com/api/storesearch/?term=" + q + "&cc=us")}`;
      const r = await fetch(searchUrl);
      const data = await r.json();
      if (data.items?.length) appIds = data.items.map(i => i.id);
    }

    if (!appIds.length) { setStatus('❌ Game tidak ditemukan.', true); return; }

    allResults = [];
    for (const id of appIds) {
      try {
        const detailUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent("https://store.steampowered.com/api/appdetails?appids=" + id + "&cc=us")}`;
        const r = await fetch(detailUrl);
        const obj = await r.json();
        if (obj[id]?.success) allResults.push(obj[id].data);
      } catch(e){}
    }

    if (!allResults.length) { setStatus('⚠️ Gagal mengambil data.', true); return; }

    shownCount = 0;
    renderResults();
    setStatus('');
  } catch (err){
    setStatus('⚠️ Terjadi error: ' + (err.message || err), true);
  }
}

function renderResults(){
  const container = document.getElementById('results');
  const slice = allResults.slice(shownCount, shownCount + perPage);
  slice.forEach(game => container.appendChild(makeCard(game)));
  shownCount += slice.length;
  if (shownCount < allResults.length) loadMoreBtn.classList.remove('hidden'); else loadMoreBtn.classList.add('hidden');
}
function loadMore(){ renderResults(); }

async function checkBranchExists(appId){
  const url = `https://api.github.com/repos/${owner}/${repo}/branches/${appId}`;
  try {
    const r = await fetch(url);
    return r.ok;
  } catch {
    return false;
  }
}

function makeCard(game){
  const wrapper = document.createElement('div');
  wrapper.className = 'bg-gray-700 p-4 rounded-lg shadow flex flex-col';

  const img = document.createElement('img');
  img.src = game.header_image || '';
  img.alt = game.name || '';
  img.className = 'w-full rounded-lg object-cover mb-3';
  wrapper.appendChild(img);

  const title = document.createElement('h3');
  title.className = 'text-lg font-semibold mb-2 text-blue-300';
  title.textContent = `${game.name || 'Unknown'} (ID: ${game.steam_appid || '-'})`;
  wrapper.appendChild(title);

  const desc = document.createElement('p');
  desc.className = 'text-sm text-gray-300 line-clamp-3 overflow-hidden';
  desc.textContent = game.short_description || '';
  wrapper.appendChild(desc);

  const btn = document.createElement('a');
  btn.className = 'mt-3 inline-block text-center px-4 py-2 rounded-lg bg-gray-500 cursor-not-allowed';
  btn.href = '#';
  btn.textContent = '⬇️ Download ZIP dari GitHub';
  wrapper.appendChild(btn);

  checkBranchExists(game.steam_appid).then(exists => {
    const releaseStr = (game.release_date && game.release_date.date) ? game.release_date.date : '';
    const releaseDate = releaseStr ? new Date(releaseStr) : null;
    const now = new Date();
    const notReleased = releaseDate ? (releaseDate > now) : false;

    if (exists && !notReleased) {
      btn.href = `https://codeload.github.com/${owner}/${repo}/zip/refs/heads/${game.steam_appid}`;
      btn.className = 'mt-3 inline-block text-center px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700';
      btn.textContent = '⬇️ Download ZIP';
    } else if (notReleased) {
      btn.textContent = '⚠️ Belum Rilis';
    } else {
      btn.textContent = '⚠️ Data tidak tersedia';
    }
  });
  return wrapper;
}
</script>
</body>
</html>
