<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéÆ ManifestHub </title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">
  <div class="w-full max-w-6xl bg-gray-800 p-6 rounded-xl shadow-lg">
    <h1 class="text-2xl font-bold text-center mb-4 flex items-center justify-center gap-2">
      üéÆ ManifestHub
    </h1>

    <!-- Input + Cari -->
    <div class="flex mb-4">
      <input id="searchInput" type="text" placeholder="Cari berdasarkan nama atau ID game..."
        class="flex-1 p-2 rounded-l-lg bg-gray-700 text-white focus:outline-none" />
      <button onclick="doSearch()" 
        class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-r-lg">
        Cari
      </button>
    </div>

    <div id="status" class="mb-4 text-sm"></div>

    <!-- Grid hasil -->
    <div id="results" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

    <div class="flex justify-center mt-4">
      <button id="loadMoreBtn" onclick="loadMore()" 
        class="hidden bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg">
        Load More
      </button>
    </div>
  </div>

<script>
const owner = "SteamAutoCracks";
const repo = "ManifestHub";
let allResults = [];
let shownCount = 0;
const perPage = 6;

function setStatus(msg, isError=false) {
  const el = document.getElementById("status");
  el.textContent = msg;
  el.className = isError ? "mb-4 text-red-400 text-sm" : "mb-4 text-yellow-300 text-sm";
}

async function doSearch() {
  const query = document.getElementById("searchInput").value.trim();
  if (!query) return;

  document.getElementById("results").innerHTML = "";
  document.getElementById("loadMoreBtn").classList.add("hidden");
  setStatus("‚è≥ Mencari game...");

  try {
    let appIds = [];

    if (/^\d+$/.test(query)) {
      appIds = [query];
    } else {
      const searchUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(
        "https://store.steampowered.com/api/storesearch/?term=" + query + "&cc=us"
      )}`;
      const res = await fetch(searchUrl);
      const data = await res.json();
      if (data.items?.length) {
        appIds = data.items.map(item => item.id);
      }
    }

    if (!appIds.length) {
      setStatus("‚ùå Game tidak ditemukan.", true);
      return;
    }

    // Ambil detail game
    allResults = [];
    for (const appId of appIds) {
      try {
        const detailUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(
          "https://store.steampowered.com/api/appdetails?appids=" + appId + "&cc=us"
        )}`;
        const res = await fetch(detailUrl);
        const data = await res.json();
        if (data[appId]?.success) {
          allResults.push(data[appId].data);
        }
      } catch {}
    }

    if (!allResults.length) {
      setStatus("‚ö†Ô∏è Gagal mengambil data.", true);
      return;
    }

    shownCount = 0;
    renderResults();
    setStatus("");
  } catch (err) {
    console.error(err);
    setStatus("‚ö†Ô∏è Terjadi error: " + err.message, true);
  }
}

function renderResults() {
  const container = document.getElementById("results");
  const slice = allResults.slice(shownCount, shownCount + perPage);
  slice.forEach(game => container.appendChild(createCard(game)));
  shownCount += slice.length;

  const btn = document.getElementById("loadMoreBtn");
  if (shownCount < allResults.length) {
    btn.classList.remove("hidden");
  } else {
    btn.classList.add("hidden");
  }
}

function loadMore() {
  renderResults();
}

// üîç cek apakah branch ada di GitHub
async function checkBranchExists(appId) {
  const url = `https://api.github.com/repos/${owner}/${repo}/branches/${appId}`;
  try {
    const res = await fetch(url);
    return res.ok;
  } catch {
    return false;
  }
}

function createCard(game) {
  const wrapper = document.createElement("div");
  wrapper.className = "bg-gray-700 p-4 rounded-lg shadow flex flex-col hover:shadow-xl hover:-translate-y-1 transition-transform duration-200";

  const img = document.createElement("img");
  img.src = game.header_image;
  img.alt = game.name;
  img.loading = "lazy";
  img.className = "w-full rounded-lg object-cover mb-3";

  const title = document.createElement("h2");
  title.className = "text-lg font-semibold mb-2 text-blue-300";
  title.textContent = `${game.name} (ID: ${game.steam_appid})`;

  // Deskripsi + tombol baca
  const descWrapper = document.createElement("div");
  descWrapper.className = "mb-2";

  const desc = document.createElement("p");
  desc.className = "text-sm text-gray-300 line-clamp-3 overflow-hidden";
  desc.textContent = game.short_description || "";
  descWrapper.appendChild(desc);

  if (game.short_description?.length > 150) {
    const moreBtn = document.createElement("button");
    moreBtn.textContent = "Baca Selengkapnya";
    moreBtn.className = "ml-1 text-blue-400 hover:underline text-sm";
    moreBtn.onclick = () => {
      if (desc.classList.contains("line-clamp-3")) {
        desc.classList.remove("line-clamp-3", "overflow-hidden");
        moreBtn.textContent = "Tutup";
      } else {
        desc.classList.add("line-clamp-3", "overflow-hidden");
        moreBtn.textContent = "Baca Selengkapnya";
      }
    };
    descWrapper.appendChild(moreBtn);
  }

  const details = document.createElement("div");
  details.className = "text-sm space-y-1";
  details.innerHTML = `
    üìÖ Rilis: ${game.release_date?.date || "-"}<br>
    üé≠ Genre: ${(game.genres || []).map(g => g.description).join(", ") || "-"}<br>
    üíª Platform: ${Object.keys(game.platforms || {}).filter(p => game.platforms[p]).join(", ") || "-"}<br>
    üí≤ Harga: ${game.is_free ? "Gratis" : (game.price_overview?.final_formatted || "Tidak diketahui")}
  `;

  // tombol default disable
// tombol default disable
const downloadBtn = document.createElement("a");
downloadBtn.textContent = "‚¨áÔ∏è Download ZIP";
downloadBtn.href = "#";
downloadBtn.className = "mt-3 inline-block text-center px-4 py-2 rounded-lg bg-gray-500 cursor-not-allowed";

// cek branch ‚Üí update tombol setelah fetch selesai
checkBranchExists(game.steam_appid).then(exists => {
  // cek apakah game sudah rilis
  const releaseDate = new Date(game.release_date?.date || "");
  const now = new Date();
  const notReleased = game.release_date && releaseDate > now;

  if (exists && !notReleased) {
    downloadBtn.href = `https://codeload.github.com/${owner}/${repo}/zip/refs/heads/${game.steam_appid}`;
    downloadBtn.className = "mt-3 inline-block text-center px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700";
    downloadBtn.textContent = "‚¨áÔ∏è Download ZIP dari GitHub";
  } else if (notReleased) {
    downloadBtn.textContent = "‚ö†Ô∏è Belum Rilis";
  } else {
    downloadBtn.textContent = "‚ö†Ô∏è DATA tidak tersedia";
  }
});


  wrapper.appendChild(img);
  wrapper.appendChild(title);
  wrapper.appendChild(descWrapper);
  wrapper.appendChild(details);
  wrapper.appendChild(downloadBtn);

  return wrapper;
}
</script>
</body>
</html>
